#add for chkconfig
#chkconfig: 2345 70 30              # 234都是文本界面,5就是图形界面X,70启动顺序号,30系统关闭停止顺序号
#description: RealServer's script   # 关于脚本的简短描述
#processname: realserver.sh         # 第一个进程名,后边设置自动时会用到
#!/bin/bash

. /etc/rc.d/init.d/functions

VIP=192.168.6.200
prog="realserver"

case "$1" in
    start)
        echo $"Starting $prog"
        ifconfig lo:0 $VIP netmask 255.255.255.255 broadcast $VIP
        /sbin/route add -host $VIP dev lo:0

        echo "1" >/proc/sys/net/ipv4/conf/lo/arp_ignore
        echo "2" >/proc/sys/net/ipv4/conf/lo/arp_announce
        echo "1" >/proc/sys/net/ipv4/conf/all/arp_ignore
        echo "2" >/proc/sys/net/ipv4/conf/all/arp_announce
        ;;
    stop)
        echo $"Stopping $prog"
        ifconfig lo:0 down
        route del $VIP >/dev/null 2>&1

        echo "0" >/proc/sys/net/ipv4/conf/lo/arp_ignore
        echo "0" >/proc/sys/net/ipv4/conf/lo/arp_announce
        echo "0" >/proc/sys/net/ipv4/conf/all/arp_ignore
        echo "0" >/proc/sys/net/ipv4/conf/all/arp_announce
        ;;
    *)
        echo "Usage: $0 {start|stop}"
        exit 1
esac
exit 0
